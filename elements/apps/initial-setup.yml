id: initial-setup
version: 0.2.5
about: System Initial Setup
merge:
  - ostree-branch.yml
  - elements/include/rlxos.inc
  - elements/include/appimage.inc

prepare-appimage: |-
  for script in first-boot installer ; do
    install -Dm0755 -t "%{install-root}%{libdir}/%{id}/" /files/%{id}/${script}.sh
    sed -i s'#@@OSTREE_BRANCH@@#%{ostree-branch}#g' %{install-root}%{libdir}/%{id}/${script}.sh
  done

  install -Dm0644 /files/AppImage.svg %{install-root}%{datadir}/icons/system-os-installer.svg

  install -vDm0644 /dev/stdin %{install-root}/%{datadir}/applications/initial-setup.desktop << "EOF"
  [Desktop Entry]
  Name=Initial Setup
  Terminal=false
  Exec=initial-setup
  Type=Application
  Icon=system-os-installer
  Categories=Utility;
  EOF

  for bin in parted fatlabel unsquashfs; do
    cp %{bindir}/$bin %{install-root}%{bindir}/
  done


build-depends:
  - components/gtkmm.yml
  - components/glib.yml
  - components/parted.yml
  - components/dosfstools.yml
  - components/squashfs-tools.yml
