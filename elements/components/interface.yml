id: interface
version: 0.1.0
about: Web Interface for rlxos

depends:
  - components/bash.yml

script: |-
  mkdir -p %{install-root}%{datadir}/%{id}/
  cp -rv /rlxos/dist/* %{install-root}%{datadir}/%{id}/

  install -v -Dm0644 /dev/stdin %{install-root}%{libdir}/sysusers.d/%{id}.conf << "EOF"
  u user_01 - "User Account" /home/user_01 %{bindir}/bash
  m user_01 video
  m user_01 seatd
  EOF

  install -v -Dm0644 /dev/stdin %{install-root}%{libdir}/systemd/system/interface@.service << "EOF"
  [Unit]
  Description=Web interface for %I
  After=systemd-user-sessions.service plymouth-quit-wait.service
  Before=graphical.target
  ConditionPathExists=/dev/tty0
  Wants=systemd-logind.service
  After=systemd-logind.service
  Conflicts=getty@%i.service
  After=getty@%i.service

  [Service]
  Type=simple
  ExecStart=%{bindir}/cage %{bindir}/cog file:///%{datadir}/%{id}/index.html
  Restart=always
  User=user_01
  UtmpIdentifier=%I
  UtmpMode=user_01
  TTYPath=/dev/%I
  TTYReset=yes
  TTYVHangup=yes
  TTYVDisallocate=yes
  StandardInput=tty-fail

  [Install]
  WantedBy=graphical.target
  Alias=display-manager.service
  DefaultInstance=tty7
  EOF

  install -v -Dm0644 /dev/stdin %{install-root}%{libdir}/systemd/system-preset/80-interface.preset << "EOF"
  enable interface@.service tty1
  EOF
