id: kmod
version: 29
about: |
  Libraries and utilities for loading kernel modules

depends:
  runtime:
    - glibc
    - openssl
    - xz
    - zlib
    - zstd
  
  buildtime:
    - pkg-config
    - patch

sources:
  - https://www.kernel.org/pub/linux/utils/kernel/kmod/kmod-29.tar.xz

packages:
  - id: pkg
    dir: kmod-29
    prescript: |
      for p in ${FILES_DIR}/*.patch ; do
        patch -Np1 -i ${p}
      done
    flags:
      - id: configure
        value: >
          --with-xz
          --with-zstd
          --with-zlib


    postscript: |
      for target in depmod insmod modinfo modprobe rmmod; do
        ln -sfv ../bin/kmod ${pkgupd_pkgdir}/usr/bin/$target
      done

      ln -sfv kmod ${pkgupd_pkgdir}/usr/bin/lsmod