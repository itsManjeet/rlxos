id: llvm
version: 16.0.6
about: |
  A collection of modular and reusable compiler and toolchain technologies

depends:
  - components/glibc.yml
build-depends:
  - components/cmake.yml

sources:
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-%{version}/llvm-%{version}.src.tar.xz
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-%{version}/cmake-%{version}.src.tar.xz
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-%{version}/clang-%{version}.src.tar.xz
  - https://github.com/llvm/llvm-project/releases/download/llvmorg-%{version}/compiler-rt-%{version}.src.tar.xz

build-dir: llvm-%{version}.src

pre-script: |-
  mv %{build-root}/clang-%{version}.src tools/clang
  mv %{build-root}/compiler-rt-%{version}.src projects/compiler-rt

environ:
  - CC=gcc
  - CXX=g++

configure: >-
  -DLLVM_ENABLE_FFI=ON
  -DCMAKE_BUILD_TYPE=Release
  -DLLVM_BUILD_LLVM_DYLIB=ON
  -DLLVM_LINK_LLVM_DYLIB=ON
  -DLLVM_ENABLE_RTTI=ON
  -DLLVM_TARGETS_TO_BUILD="host;AMDGPU;BPF"
  -DLLVM_BINUTILS_INCDIR=/usr/include
  -DLLVM_INCLUDE_BENCHMARKS=OFF
  -DCLANG_DEFAULT_PIE_ON_LINUX=ON

post-script: |-
  cp bin/FileCheck %{install-root}/usr/bin/
