id: bzip2
version: 1.0.8
about: |
  compressing and decompressing files

depends:
  runtime:
    - glibc

sources:
  - https://www.sourceware.org/pub/bzip2/bzip2-1.0.8.tar.gz
  - https://www.linuxfromscratch.org/patches/lfs/development/bzip2-1.0.8-install_docs-1.patch

packages:
  - id: lib
    dir: bzip2-1.0.8
    prescript: |
      patch -Np1 -i ../bzip2-1.0.8-install_docs-1.patch

      sed -i "s@\(ln -s -f \)\$(PREFIX)/bin/@\1@" Makefile
      sed -i "s@(PREFIX)/man@(PREFIX)/share/man@g" Makefile
    
    plugin: script
    script: |
      make -f Makefile-libbz2_so
      make clean

      make
      make PREFIX=${pkgupd_pkgdir}/usr install

      cp -av libbz2.so.* ${pkgupd_pkgdir}/usr/lib/
      ln -sv libbz2.so.1.0.8 ${pkgupd_pkgdir}/usr/lib/libbz2.so

      cp -v bzip2-shared ${pkgupd_pkgdir}/usr/bin/bzip2
      for i in bzcat bunzip2 ; do
        ln -sfv bzip2 ${pkgupd_pkgdir}/usr/bin/$i
      done

      rm -fv ${pkgupd_pkgdir}/usr/lib/libbz2.a