id: grub
version: 2.06
about: |
  GRand Unified Bootloader

depends:
  runtime:
    - gettext
    - bash
    - xz
    - efibootmgr
    - freetype
    - libisoburn

  buildtime:
    - python
    - flex
    - m4
    - bison

environ:
  - PYTHON=python3

packages:
  - id: legacy
    dir: grub-2.06
    sources:
      - http://ftp.gnu.org/gnu/grub/grub-2.06.tar.xz

    prescript: |
      cd ${PKGUPD_WORKDIR}/src/grub-2.06
      # patch -p1 < ${FILES}/grub/0001-Fixed-for-rlxos-update-grub.patch
      # patch -p1 < ${FILES}/grub/0001-Fixed-to-search-rlxos-system-images.patch
      rm autogen.sh
    flags:
      - id: configure
        value: >
          --disable-werror
          --disable-efiemu
          --with-platform=pc
          --target=i386
          --disable-nls
          CFLAGS="-Os"
          CXXFLAGS="${CFLAGS}"
        
  - id: efi
    dir: grub-2.04
    sources:
      - http://ftp.gnu.org/gnu/grub/grub-2.04.tar.xz

    prescript: |
      cd ${PKGUPD_WORKDIR}/src/grub-2.04
      patch -p1 < ${FILES}/grub/0001-Fixed-for-rlxos-update-grub.patch
      patch -p1 < ${FILES}/grub/0001-Fixed-to-search-rlxos-system-images.patch
      rm autogen.sh

    flags:
      - id: configure
        value: >
          --disable-werror
          --disable-efiemu
          --enable-grub-mkfont
          --with-platform=efi
          --target=x86_64
          --with-bootdir=/run/initramfs/boot/
          CFLAGS="-Os"
          CXXFLAGS="${CFLAGS}"

    postscript: |
      install -v -D -m 0644 ${FILES}/grub/grub.default ${pkgupd_pkgdir}/etc/default/grub
      install -v -D -m 0755 ${FILES}/grub/update-grub.sh ${pkgupd_pkgdir}/usr/bin/update-grub
      install -v -D  ${FILES}/grub/unifont-13.0.06.bdf ${pkgupd_pkgdir}/usr/share/grub/unifont.pf2