id: lightdm
version: 1.30.0
about: |
  A lightweight display manager based upon GTK

split: false

depends:
  runtime:
    - libgcrypt
    - itstool
    - pam
    - pcre
    - libxklavier
    - accountsservice
sources:
  - https://github.com/CanonicalLtd/lightdm/releases/download/1.30.0/lightdm-1.30.0.tar.xz
  - https://github.com/Xubuntu/lightdm-gtk-greeter/releases/download/lightdm-gtk-greeter-2.0.8/lightdm-gtk-greeter-2.0.8.tar.gz

groups:
  - id: 65
    name: lightdm

users:
  - id: 65
    name: lightdm
    group: 65
    about: Lightdm Daemon
    dir: /var/lib/lightdm
    shell: /bin/false

packages:
  - id: pkg
    dir: lightdm-1.30.0

    flags:
      - id: configurator
        value: configure

      - id: configure
        value: >
          --libexecdir=/usr/lib/lightdm
          --disable-static
          --disable-tests
          --with-greeter-user=lightdm
          --with-greeter-session=lightdm-gtk-greeter
    
    postscript: |
      install -v -D -m 755 ${pkgupd_srcdir}/tests/src/lightdm-session -t ${pkgupd_pkgdir}/usr/bin/
      sed -i "1 s/sh/bash --login/" ${pkgupd_pkgdir}/usr/bin/lightdm-session
      rm -rf ${pkgupd_pkgdir}/etc/init
      install -v -d -m 755 -o 65 -g 65 ${pkgupd_pkgdir}/var/lib/lightdm
      install -v -d -m 755 -o 65 -g 65 ${pkgupd_pkgdir}/var/lib/lightdm-data
      install -v -d -m 755 -o 65 -g 65 ${pkgupd_pkgdir}/var/cache/lightdm
      install -v -d -m 755 -o 65 -g 65 ${pkgupd_pkgdir}/var/log/lightdm

      install -v -D -m 644 ${FILES}/lightdm/lightdm.service -t ${pkgupd_pkgdir}/usr/lib/systemd/system

  - id: greeter
    dir: lightdm-gtk-greeter-2.0.8

    flags:
      - id: configure
        value: >
          --libexecdir=/usr/lib/lightdm
          --with-libxklavier
          --enable-kill-on-sigterm
          --disable-libido
          --disable-libindicator
          --disable-static
          --disable-maintainer-mode