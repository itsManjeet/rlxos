id: openrc
version: 0.43
about: |
  Dependency based init system that works with sysvinit and systemd or on its own

depends:
  runtime:
    - pam
    - psmisc

sources:
  - openrc-0.43.tar.gz::https://github.com/OpenRC/openrc/archive/0.43.tar.gz

packages:
  - id: pkg
    dir: openrc-0.43

    environ:
      - BUILDARGS=(BRANDING='rlxos')
      - BUILDARGS+=(MKPAM=pam)
      - BUILDARGS+=(MKSELINUX=no)
      - BUILDARGS+=(MKTERMCAP=ncurses)
      - BUILDARGS+=(PKG_PREFIX="")
      - BUILDARGS+=(LIBDIR=/usr/lib)
      - BUILDARGS+=(SHLIBDIR=/usr/lib)
      - BUILDARGS+=(LIBEXECDIR=/usr/lib/rc)
      - BUILDARGS+=(BINDIR=/usr/bin)
      - BUILDARGS+=(SBINDIR=/usr/bin)
      - BUILDARGS+=(SYSCONFDIR=/etc)

    plugin: script
    script: |
      sed -i "s:0444:6444:" mk/sys.mk
      sed -ie "s!/sbin/rc!/usr/bin/rc!g" support/sysvinit/inittab

      make "${BUILDARGS[@]}"

      make DESTDIR="${pkgupd_pkgdir}" "${BUILDARGS[@]}" install
      install -m 644 support/sysvinit/inittab ${pkgupd_pkgdir}/etc/inittab

      install -D -m 0644 ${FILES}/openrc.logrotate ${pkgupd_pkgdir}/etc/logrotate.d/openrc

      mkdir -p ${pkgupd_pkgdir}/etc/runlevels/default
      for i in {1..7} ; do
        ln -s agetty ${pkgupd_pkgdir}/etc/init.d/agetty.tty${i}
        ln -s /etc/init.d/agetty.tty${i} ${pkgupd_pkgdir}/etc/runlevels/default/
      done


