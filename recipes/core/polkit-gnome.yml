id: polkit-gnome
version: 0.105
about: |
  An Authentication Agent for Polkit that integrates well with the GNOME Desktop environment

depends:
  runtime:
    - accountsservice
    - gtk
    - polkit

sources:
  - https://download.gnome.org/sources/polkit-gnome/0.105/polkit-gnome-0.105.tar.xz
  - https://www.linuxfromscratch.org/patches/blfs/svn/polkit-gnome-0.105-consolidated_fixes-1.patch

packages:
  - id: pkg
    dir: polkit-gnome-0.105
    prescript: |
      patch -Np1 -i ../polkit-gnome-0.105-consolidated_fixes-1.patch

    flags:
      - id: configurator
        value: configure
        
    postscript: |
      mkdir -p ${pkgupd_pkgdir}/etc/xdg/autostart
      cat > ${pkgupd_pkgdir}/etc/xdg/autostart/polkit-gnome-authentication-agent-1.desktop << "EOF"
      [Desktop Entry]
      Name=PolicyKit Authentication Agent
      Comment=PolicyKit Authentication Agent
      Exec=/usr/lib/polkit-gnome-authentication-agent-1
      Terminal=false
      Type=Application
      Categories=
      NoDisplay=true
      OnlyShowIn=GNOME;XFCE;Unity;
      AutostartCondition=GNOME3 unless-session gnome
      EOF